{% extends "base.html" %}

{% block tieu_de %}Qu·∫£n L√Ω Danh M·ª•c{% endblock %}

{% block noi_dung %}
<div class="container-fluid">
    <!-- Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h3 text-primary">
                        <i class="fas fa-tags me-2"></i>
                        Qu·∫£n L√Ω Danh M·ª•c
                    </h1>
                </div>
            </div>
        </div>
    </div>

    <!-- C√†i ƒë·∫∑t -->
    <div class="row g-4">
        <!-- Qu·∫£n l√Ω danh m·ª•c thu chi -->
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-tags me-2"></i>
                        Qu·∫£n L√Ω Danh M·ª•c Thu Chi
                    </h5>
                </div>
                <div class="card-body">
                    <!-- Tabs cho Thu v√† Chi -->
                    <ul class="nav nav-tabs mb-3" id="danh-muc-tabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="danh-muc-thu-tab" data-bs-toggle="tab" data-bs-target="#danh-muc-thu" type="button">
                                <i class="fas fa-plus-circle text-success me-1"></i>Danh M·ª•c Thu
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="danh-muc-chi-tab" data-bs-toggle="tab" data-bs-target="#danh-muc-chi" type="button">
                                <i class="fas fa-minus-circle text-danger me-1"></i>Danh M·ª•c Chi
                            </button>
                        </li>
                    </ul>

                    <!-- Tab content -->
                    <div class="tab-content" id="danh-muc-tab-content">
                        <!-- Tab Danh m·ª•c Thu -->
                        <div class="tab-pane fade" id="danh-muc-thu" role="tabpanel" aria-labelledby="danh-muc-thu-tab">
                            <div class="row">
                                <div class="col-md-4">
                                    <h6>Th√™m danh m·ª•c thu m·ªõi</h6>
                                    <div class="mb-3">
                                        <label class="form-label">Ch·ªçn emoji</label>
                                        <div id="emoji-picker-thu-container"></div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">T√™n danh m·ª•c</label>
                                        <input type="text" class="form-control" id="ten-danh-muc-thu" placeholder="VD: L∆∞∆°ng, Th∆∞·ªüng...">
                                    </div>
                                    <button class="btn btn-success w-100" type="button" onclick="them_danh_muc('thu')">
                                        <i class="fas fa-plus me-1"></i>Th√™m danh m·ª•c
                                    </button>
                                </div>
                                <div class="col-md-8">
                                    <h6>Danh s√°ch danh m·ª•c thu</h6>
                                    <div id="danh-sach-thu" class="list-group">
                                        <!-- S·∫Ω ƒë∆∞·ª£c load b·∫±ng JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Tab Danh m·ª•c Chi -->
                        <div class="tab-pane fade show active" id="danh-muc-chi" role="tabpanel" aria-labelledby="danh-muc-chi-tab">
                            <div class="row">
                                <div class="col-md-4">
                                    <h6>Th√™m danh m·ª•c chi m·ªõi</h6>
                                    <div class="mb-3">
                                        <label class="form-label">Ch·ªçn emoji</label>
                                        <div id="emoji-picker-chi-container"></div>
                                    </div>
                                    <div class="mb-3">
                                        <label class="form-label">T√™n danh m·ª•c</label>
                                        <input type="text" class="form-control" id="ten-danh-muc-chi" placeholder="VD: ƒÇn s√°ng, XƒÉng xe...">
                                    </div>
                                    <button class="btn btn-danger w-100" type="button" onclick="them_danh_muc('chi')">
                                        <i class="fas fa-plus me-1"></i>Th√™m danh m·ª•c
                                    </button>
                                </div>
                                <div class="col-md-8">
                                    <h6>Danh s√°ch danh m·ª•c chi</h6>
                                    <div id="danh-sach-chi" class="list-group">
                                        <!-- S·∫Ω ƒë∆∞·ª£c load b·∫±ng JavaScript -->
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- C√†i ƒë·∫∑t ti·ªÅn t·ªá -->
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="fas fa-yen-sign me-2"></i>
                        C√†i ƒê·∫∑t Ti·ªÅn T·ªá
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row g-3">
                        <div class="col-md-6">
                            <label class="form-label">ƒê∆°n v·ªã ti·ªÅn t·ªá ch√≠nh</label>
                            <select class="form-control" id="don-vi-tien-te">
                                <option value="VND">üáªüá≥ Vi·ªát Nam ƒê·ªìng (VND)</option>
                                <option value="JPY">üáØüáµ Y√™n Nh·∫≠t (JPY)</option>
                                <option value="USD">üá∫üá∏ ƒê√¥ la M·ªπ (USD)</option>
                                <option value="EUR">üá™üá∫ Euro (EUR)</option>
                            </select>
                            <small class="form-text text-muted">ƒê∆°n v·ªã ti·ªÅn t·ªá s·∫Ω ƒë∆∞·ª£c s·ª≠ d·ª•ng trong trang Thu Chi v√† Dashboard</small>
                        </div>
                        
                        <div class="col-12">
                            <div class="row g-2">
                                <div class="col-md-3">
                                    <label class="form-label">ƒê·ªãnh d·∫°ng hi·ªÉn th·ªã</label>
                                    <select class="form-control" id="dinh-dang-tien">
                                        <option value="standard">Chu·∫©n (1,000)</option>
                                        <option value="short">R√∫t g·ªçn (1K)</option>
                                        <option value="full">ƒê·∫ßy ƒë·ªß (1,000.00)</option>
                                    </select>
                                </div>
                                
                                <div class="col-md-3">
                                    <label class="form-label">Hi·ªÉn th·ªã k√Ω hi·ªáu</label>
                                    <select class="form-control" id="hien-thi-ky-hieu">
                                        <option value="prefix">Tr∆∞·ªõc s·ªë (¬•1,000)</option>
                                        <option value="suffix">Sau s·ªë (1,000¬•)</option>
                                        <option value="both">C·∫£ hai (¬•1,000 JPY)</option>
                                    </select>
                                </div>
                                
                                <div class="col-md-6">
                                    <label class="form-label">Xem tr∆∞·ªõc</label>
                                    <div class="form-control-plaintext bg-light rounded p-2">
                                        <span id="xem-truoc-tien">¬•1,000</span>
                                        <small class="text-muted ms-2">(V√≠ d·ª•: 1000 ƒë∆°n v·ªã)</small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-12">
                            <div class="d-flex gap-2">
                                <button type="button" class="btn btn-primary" onclick="luu_cai_dat_tien_te()">
                                    <i class="fas fa-save me-1"></i>L∆∞u C√†i ƒê·∫∑t
                                </button>
                                <button type="button" class="btn btn-outline-secondary" onclick="tai_cai_dat_tien_te()">
                                    <i class="fas fa-undo me-1"></i>Kh√¥i Ph·ª•c
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Toast th√¥ng b√°o -->
<div class="position-fixed bottom-0 end-0 p-3" style="z-index: 11">
    <div id="toast-cai-dat" class="toast hide" role="alert">
        <div class="toast-header">
            <i class="fas fa-check-circle text-success me-2"></i>
            <strong class="me-auto">C√†i ƒë·∫∑t</strong>
            <button type="button" class="btn-close" data-bs-dismiss="toast"></button>
        </div>
        <div class="toast-body" id="toast-message">
            ƒê√£ l∆∞u c√†i ƒë·∫∑t th√†nh c√¥ng!
        </div>
    </div>
</div>

<!-- Custom CSS cho emoji picker -->
<style>
    /* L√†m ƒë·∫πp dropdown emoji */
    #emoji-thu option, #emoji-chi option {
        font-size: 16px;
        padding: 8px 12px;
    }
    
    /* Hover effect cho list group items */
    .list-group-item:hover {
        background-color: #f8f9fa;
    }
    
    /* Style cho emoji trong list */
    .list-group-item span:first-child {
        font-size: 18px;
        margin-right: 8px;
    }
    
    /* Button group styling */
    .btn-group-sm .btn {
        padding: 0.25rem 0.5rem;
        font-size: 0.875rem;
    }
    
    /* Tab content spacing */
    .tab-content {
        padding-top: 15px;
    }
    
    /* ƒê·∫£m b·∫£o tab pane ho·∫°t ƒë·ªông ƒë√∫ng */
    .tab-pane {
        display: none !important;
    }
    
    .tab-pane.show.active {
        display: block !important;
    }
    
    /* Form controls trong tabs */
    .tab-pane .form-label {
        font-weight: 600;
        color: #495057;
    }
    
    /* Responsive cho mobile */
    @media (max-width: 767px) {
        .tab-content .row .col-md-4,
        .tab-content .row .col-md-8 {
            margin-bottom: 1rem;
        }
    }
    
    /* Emoji Picker Styles */
    .emoji-picker {
        background: #f8f9fa;
        border: 1px solid #dee2e6;
        border-radius: 8px;
    }
    
    .emoji-btn {
        transition: all 0.2s ease;
        border-radius: 6px !important;
        margin: 2px;
    }
    
    .emoji-btn:hover {
        background-color: #e9ecef !important;
        transform: scale(1.1);
    }
    
    .emoji-btn.active {
        background-color: #0d6efd !important;
        color: white !important;
        transform: scale(1.1);
    }
    
    .emoji-category h6 {
        font-weight: 600;
        margin-bottom: 8px;
    }
    
    .emoji-row {
        gap: 4px;
        margin-bottom: 12px;
    }
</style>

<script src="{{ url_for('static', filename='js/quan_ly_danh_muc.js') }}"></script>
<script src="{{ url_for('static', filename='js/emoji_picker.js') }}"></script>
<script src="{{ url_for('static', filename='js/tien_te.js') }}"></script>

<script>
// ƒê·∫£m b·∫£o Bootstrap tabs ho·∫°t ƒë·ªông ƒë√∫ng
document.addEventListener('DOMContentLoaded', function() {
    // Kh·ªüi t·∫°o Bootstrap tabs
    const triggerTabList = [].slice.call(document.querySelectorAll('#danh-muc-tabs button'))
    triggerTabList.map(function (triggerEl) {
        return new bootstrap.Tab(triggerEl)
    });
    
    // ƒê·∫£m b·∫£o ch·ªâ tab active ƒë∆∞·ª£c hi·ªÉn th·ªã
    const allTabPanes = document.querySelectorAll('.tab-pane');
    const activeTabPane = document.querySelector('.tab-pane.show.active');
    
    allTabPanes.forEach(pane => {
        if (pane !== activeTabPane) {
            pane.classList.remove('show', 'active');
        }
    });
    
    // Th√™m event listener cho tab change
    document.addEventListener('shown.bs.tab', function (event) {
        // ·∫®n t·∫•t c·∫£ tab panes
        allTabPanes.forEach(pane => {
            pane.classList.remove('show', 'active');
        });
        
        // Hi·ªÉn th·ªã tab ƒë∆∞·ª£c ch·ªçn
        const targetId = event.target.getAttribute('data-bs-target');
        const targetPane = document.querySelector(targetId);
        if (targetPane) {
            targetPane.classList.add('show', 'active');
        }
    });
});
</script>
{% endblock %}
