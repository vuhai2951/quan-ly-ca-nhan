/* CSS Fix cho Modal trên Mobile và iOS */

/* ===================================
   MODAL MOBILE FIXES
   ================================= */

/* Force modal z-index to be on top */
.modal {
    z-index: 9999 !important;
}

.modal-backdrop {
    z-index: 9998 !important;
}

/* Mobile modal responsive fixes */
@media (max-width: 768px) {
    /* Force modal positioning */
    .modal {
        z-index: 9999 !important;
        position: fixed !important;
        top: 0 !important;
        left: 0 !important;
        width: 100% !important;
        height: 100% !important;
        overflow-x: hidden !important;
        overflow-y: auto !important;
        background: rgba(0, 0, 0, 0.5) !important;
        padding: 0 !important;
    }
    
    .modal-dialog {
        margin: 10px !important;
        width: calc(100% - 20px) !important;
        max-width: calc(100% - 20px) !important;
        position: relative !important;
        transform: none !important;
        top: 20px !important;
        left: 0 !important;
        right: 0 !important;
        z-index: 10000 !important;
        height: auto !important;
        max-height: calc(100vh - 40px) !important;
        overflow: hidden !important;
    }
    
    .modal-content {
        border-radius: 12px !important;
        border: none !important;
        box-shadow: 0 15px 50px rgba(0, 0, 0, 0.4) !important;
        max-height: calc(100vh - 40px) !important;
        overflow: hidden !important;
        background: white !important;
        position: relative !important;
        z-index: 10001 !important;
    }
    
    .modal-body {
        max-height: calc(100vh - 200px) !important;
        overflow-y: auto !important;
        -webkit-overflow-scrolling: touch !important;
        padding: 1rem !important;
    }
    
    .modal-header {
        padding: 1rem !important;
        border-bottom: 1px solid #dee2e6 !important;
        background: #f8f9fa !important;
        border-radius: 12px 12px 0 0 !important;
        position: sticky !important;
        top: 0 !important;
        z-index: 10002 !important;
    }
    
    .modal-footer {
        padding: 1rem !important;
        border-top: 1px solid #dee2e6 !important;
        background: #f8f9fa !important;
        border-radius: 0 0 12px 12px !important;
        position: sticky !important;
        bottom: 0 !important;
        z-index: 10002 !important;
    }
    
    /* Form controls trong modal */
    .modal .form-control,
    .modal .form-select {
        font-size: 16px !important; /* Prevent zoom on iOS */
        border-radius: 8px !important;
        padding: 0.75rem !important;
        border: 2px solid #dee2e6 !important;
        background: white !important;
        position: relative !important;
        z-index: 1 !important;
    }
    
    .modal .form-control:focus,
    .modal .form-select:focus {
        border-color: #0d6efd !important;
        box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.25) !important;
        outline: none !important;
    }
    
    /* Button trong modal */
    .modal .btn {
        padding: 0.75rem 1.5rem !important;
        font-size: 16px !important; /* Prevent zoom on iOS */
        border-radius: 8px !important;
        font-weight: 600 !important;
        min-height: 48px !important; /* Touch target */
        min-width: 80px !important;
        display: inline-flex !important;
        align-items: center !important;
        justify-content: center !important;
        gap: 0.5rem !important;
    }
    
    /* Labels và text */
    .modal .form-label {
        font-weight: 600 !important;
        color: #495057 !important;
        margin-bottom: 0.5rem !important;
        font-size: 14px !important;
    }
    
    .modal .form-label .text-danger {
        color: #dc3545 !important;
    }
    
    /* Textarea */
    .modal textarea.form-control {
        min-height: 80px !important;
        resize: vertical !important;
    }
    
    /* Input number */
    .modal input[type="number"] {
        text-align: right !important;
    }
    
    /* Modal title */
    .modal-title {
        font-size: 1.25rem !important;
        font-weight: 700 !important;
        color: #212529 !important;
        display: flex !important;
        align-items: center !important;
        gap: 0.5rem !important;
    }
    
    /* Close button */
    .modal .btn-close {
        width: 32px !important;
        height: 32px !important;
        background-size: 16px !important;
        opacity: 0.7 !important;
    }
    
    .modal .btn-close:hover {
        opacity: 1 !important;
    }
}

/* iOS specific fixes */
@supports (-webkit-touch-callout: none) {
    @media (max-width: 768px) {
        /* iOS specific modal fixes */
        .modal {
            -webkit-overflow-scrolling: touch !important;
            -webkit-transform: translateZ(0) !important;
            transform: translateZ(0) !important;
        }
        
        .modal-dialog {
            -webkit-transform: translateZ(0) !important;
            transform: translateZ(0) !important;
        }
        
        .modal-content {
            -webkit-transform: translateZ(0) !important;
            transform: translateZ(0) !important;
            -webkit-backface-visibility: hidden !important;
            backface-visibility: hidden !important;
        }
        
        /* Prevent body scroll when modal is open */
        body.modal-open {
            position: fixed !important;
            width: 100% !important;
            height: 100% !important;
            overflow: hidden !important;
            -webkit-overflow-scrolling: auto !important;
        }
        
        /* Input focus fixes for iOS */
        .modal .form-control:focus,
        .modal .form-select:focus {
            -webkit-transform: translateZ(0) !important;
            transform: translateZ(0) !important;
        }
    }
}

/* PWA and safe area support for modals */
@supports (padding: max(0px)) {
    @media (max-width: 768px) {
        .modal-dialog {
            margin-top: max(env(safe-area-inset-top, 0px), 10px) !important;
            margin-bottom: max(env(safe-area-inset-bottom, 0px), 10px) !important;
            margin-left: max(env(safe-area-inset-left, 0px), 10px) !important;
            margin-right: max(env(safe-area-inset-right, 0px), 10px) !important;
            width: calc(100% - max(env(safe-area-inset-left, 0px), 10px) - max(env(safe-area-inset-right, 0px), 10px)) !important;
            max-width: calc(100% - max(env(safe-area-inset-left, 0px), 10px) - max(env(safe-area-inset-right, 0px), 10px)) !important;
            max-height: calc(100vh - max(env(safe-area-inset-top, 0px), 10px) - max(env(safe-area-inset-bottom, 0px), 10px)) !important;
        }
    }
}

/* Force modal to appear above everything */
@media (max-width: 768px) {
    /* Bottom navigation should be behind modal */
    .bottom-nav {
        z-index: 1000 !important;
    }
    
    /* Navbar should be behind modal */
    .navbar {
        z-index: 1020 !important;
    }
    
    /* Toast notifications should be above modal */
    .toast-container {
        z-index: 10100 !important;
    }
    
    /* Dropdown menus should be behind modal */
    .dropdown-menu {
        z-index: 1050 !important;
    }
}

/* Smooth modal animations */
.modal.fade .modal-dialog {
    transition: transform 0.3s ease-out !important;
    transform: translate(0, -50px) !important;
}

.modal.show .modal-dialog {
    transform: none !important;
}

@media (max-width: 768px) {
    .modal.fade .modal-dialog {
        transform: translateY(50px) !important;
    }
    
    .modal.show .modal-dialog {
        transform: translateY(0) !important;
    }
}

/* Form validation styling */
.modal .is-invalid {
    border-color: #dc3545 !important;
    box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25) !important;
}

.modal .is-valid {
    border-color: #198754 !important;
    box-shadow: 0 0 0 0.2rem rgba(25, 135, 84, 0.25) !important;
}

/* Loading state cho buttons trong modal */
.modal .btn.loading {
    position: relative !important;
    color: transparent !important;
}

.modal .btn.loading::after {
    content: "" !important;
    position: absolute !important;
    width: 16px !important;
    height: 16px !important;
    top: 50% !important;
    left: 50% !important;
    margin-left: -8px !important;
    margin-top: -8px !important;
    border: 2px solid transparent !important;
    border-top-color: currentColor !important;
    border-radius: 50% !important;
    animation: spin 1s linear infinite !important;
}

@keyframes spin {
    0% { transform: rotate(0deg); }
    100% { transform: rotate(360deg); }
}
